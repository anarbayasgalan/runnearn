<div class="login-container">
    <div class="card login-card">
        <h2 class="text-gradient">Reset Password</h2>
        <p style="color: var(--color-text-muted); margin-bottom: 2rem;">
            {{ step() === 'email' ? 'Enter your email to receive OTP' :
            step() === 'otp' ? 'Enter the 6-digit code sent to your email' :
            'Create your new password' }}
        </p>

        <!-- Step 1: Email Entry -->
        <form *ngIf="step() === 'email'" [formGroup]="emailForm" (ngSubmit)="requestOTP()">
            <div class="form-group">
                <label>Email</label>
                <input type="email" formControlName="userName" class="input-field" placeholder="Enter your email"
                    autofocus>
            </div>

            <div *ngIf="errorMsg()" class="error-msg">{{ errorMsg() }}</div>
            <div *ngIf="successMsg()" class="success-msg">{{ successMsg() }}</div>

            <button type="submit" class="btn btn-primary" [disabled]="emailForm.invalid || isLoading()"
                style="width: 100%; margin-top: 1rem;">
                {{ isLoading() ? 'Sending...' : 'Send OTP' }}
            </button>
        </form>

        <!-- Step 2: OTP Verification -->
        <form *ngIf="step() === 'otp'" [formGroup]="otpForm" (ngSubmit)="verifyOTP()">
            <div class="form-group">
                <label>Enter OTP</label>
                <input type="text" formControlName="otpCode" class="input-field" placeholder="6-digit code"
                    maxlength="6" autofocus>
                <small style="color: var(--color-text-muted); font-size: 0.85rem;">
                    Check your email for the verification code
                </small>
            </div>

            <div *ngIf="errorMsg()" class="error-msg">{{ errorMsg() }}</div>
            <div *ngIf="successMsg()" class="success-msg">{{ successMsg() }}</div>

            <button type="submit" class="btn btn-primary" [disabled]="otpForm.invalid || isLoading()"
                style="width: 100%; margin-top: 1rem;">
                {{ isLoading() ? 'Verifying...' : 'Verify OTP' }}
            </button>
        </form>

        <!-- Step 3: New Password -->
        <form *ngIf="step() === 'password'" [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
            <div class="form-group">
                <label>New Password</label>
                <input type="password" formControlName="newPassword" class="input-field"
                    placeholder="Enter new password" autofocus>
            </div>

            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" formControlName="confirmPassword" class="input-field"
                    placeholder="Repeat new password">
                <div *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched"
                    style="color: #ef4444; font-size: 0.85rem; margin-top: 0.25rem; font-weight: 500;">
                    Passwords don't match!
                </div>
            </div>

            <div *ngIf="errorMsg()" class="error-msg">{{ errorMsg() }}</div>
            <div *ngIf="successMsg()" class="success-msg">{{ successMsg() }}</div>

            <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || isLoading()"
                style="width: 100%; margin-top: 1rem;">
                {{ isLoading() ? 'Resetting...' : 'Reset Password' }}
            </button>
        </form>

        <div style="margin-top: 1.5rem; text-align: center; font-size: 0.9rem;">
            <a routerLink="/login" style="color: var(--color-primary); text-decoration: none;">
                Back to Login
            </a>
        </div>
    </div>
</div>